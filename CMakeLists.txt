cmake_minimum_required(VERSION 2.8)
project(motis)

foreach(flags CMAKE_C_FLAGS CMAKE_C_FLAGS_RELEASE CMAKE_C_FLAGS_DEBUG)
  string(REPLACE "-O3" "-O2" ${flags} "${${flags}}")
endforeach()

foreach(flags CMAKE_CXX_FLAGS CMAKE_CXX_FLAGS_RELEASE CMAKE_CXX_FLAGS_DEBUG)
  string(REPLACE "-O3" "-O2" ${flags} "${${flags}}")
endforeach()

option(MOTIS_STATIC_MODULES "MOTIS_STATIC_MODULES" TRUE)
if (MOTIS_STATIC_MODULES)
  add_definitions(-DMOTIS_STATIC_MODULES)
else()
  set(CMAKE_SHARED_LIBRARY_SUFFIX "")
  set(CMAKE_SHARED_LIBRARY_PREFIX "")
endif()

if (MSVC)
  set(Boost_USE_STATIC_LIBS ON)
endif()
find_package(Boost COMPONENTS system filesystem regex program_options REQUIRED)
find_package(Threads)

link_directories(${Boost_LIBRARY_DIRS})
include_directories(SYSTEM ${Boost_INCLUDE_DIR})
include_directories(SYSTEM ${CMAKE_SOURCE_DIR}/external_lib/websocketpp)
include_directories(SYSTEM ${CMAKE_SOURCE_DIR}/external_lib/flatbuffers/include)
include_directories(SYSTEM ${CMAKE_SOURCE_DIR}/external_lib)  # catch library
include_directories(${CMAKE_SOURCE_DIR}/external_lib/conf/include)
include_directories(${CMAKE_SOURCE_DIR}/external_lib/net/include)
include_directories(${CMAKE_SOURCE_DIR}/external_lib/guess/include)
include_directories(${CMAKE_SOURCE_DIR}/external_lib/parser/include)
include_directories(${CMAKE_SOURCE_DIR}/motis/core/include)
include_directories(${CMAKE_SOURCE_DIR}/motis/loader/include)
include_directories(${CMAKE_SOURCE_DIR}/motis/module/include)
include_directories(${CMAKE_SOURCE_DIR}/modules/routing/include)
include_directories(${CMAKE_BINARY_DIR}/generated)

add_subdirectory(external_lib/flatbuffers EXCLUDE_FROM_ALL)
add_subdirectory(external_lib/conf EXCLUDE_FROM_ALL)
add_subdirectory(external_lib/parser EXCLUDE_FROM_ALL)
add_subdirectory(external_lib/net EXCLUDE_FROM_ALL)
add_subdirectory(external_lib/guess EXCLUDE_FROM_ALL)

add_subdirectory(motis/core EXCLUDE_FROM_ALL)
add_subdirectory(motis/loader EXCLUDE_FROM_ALL)
add_subdirectory(motis/module EXCLUDE_FROM_ALL)

function(add_modules)
  foreach(module ${ARGV})
    add_subdirectory(modules/${module})
  endforeach(module)
endfunction()
add_modules(railviz routing reliability guesser)

add_subdirectory(motis/webservice)
