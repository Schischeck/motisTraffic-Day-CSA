cmake_minimum_required(VERSION 2.8)
project(motis)

option(WITH_MYSQL "MySQL support" OFF)

include_directories(include)
include_directories(../routing/include)

if(WITH_MYSQL)
  message("Database support enabled")
  set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${PROJECT_SOURCE_DIR}/cmake/Modules")
  find_package(MySQL REQUIRED)
  find_package(MySQLpp REQUIRED)
  include_directories(${MYSQL_INCLUDE_DIR} ${MYSQLPP_INCLUDE_DIR})
  set(DB_LIBRARIES ${MYSQL_LIBRARIES} ${MYSQLPP_LIBRARIES})
  add_definitions(-DWITH_MYSQL)
else()
  message("Database support disabled")
  set(DB_LIBRARIES)
endif()

file(GLOB_RECURSE motis-realtime-files src/*.cc)
add_library(motis-realtime STATIC ${motis-realtime-files})
target_link_libraries(motis-realtime ${Boost_PROGRAM_OPTIONS_LIBRARY} ${Boost_SYSTEM_LIBRARY})
target_link_libraries(motis-realtime ${MYSQL_LIBRARIES} ${MYSQLPP_LIBRARIES})
target_link_libraries(motis-realtime motis-loader)
set_target_properties(motis-realtime PROPERTIES COMPILE_FLAGS -std=c++11 -Wall -Wextra)

file(GLOB_RECURSE motis-realtime-test-files test/*.cc)
add_executable(motis-realtime-test ${motis-realtime-test-files})
set_target_properties(motis-realtime-test PROPERTIES COMPILE_FLAGS -std=c++11 -Wall -Wextra)
target_link_libraries(motis-realtime-test motis-realtime motis-loader motis-routing)

if(WITH_MYSQL)
  file(GLOB_RECURSE motis-realtime-dump-files tools/dump/*.cc)
  add_executable(motis-realtime-dump
    ${motis-realtime-dump-files}
    src/database.cc
    src/opt_time.cc
  )
  target_link_libraries(motis-realtime-dump ${Boost_PROGRAM_OPTIONS_LIBRARY} ${Boost_SYSTEM_LIBRARY})
  target_link_libraries(motis-realtime-dump ${DB_LIBRARIES} conf)
  set_target_properties(motis-realtime-dump PROPERTIES COMPILE_FLAGS -std=c++11 -Wall -Wextra)
endif()
